require 'puree'
require 'puree-rails'
require_relative 'domain'

<% if namespace.nil? -%>
module Persistence

  def id_generator
    @id_generator ||= PureeRails::ActiveRecordIdGenerator.instance
  end

  def event_store
    @event_store ||= PureeRails::ActiveRecordEventStore.instance
  end

  def event_dispatcher
    @event_dispatcher ||= Puree::EventDispatcher.instance
  end
end
<% else -%>
module <%= namespace_class_name %>
  module Persistence

    def id_generator
      @id_generator ||= PureeRails::ActiveRecordIdGenerator.instance
    end

    def event_store
      @event_store ||= PureeRails::ActiveRecordEventStore.instance
    end

    def event_dispatcher
      @event_dispatcher ||= Puree::EventDispatcher.instance
    end
  end
end
<% end -%>